# Migration `20200822085623-lemsos`

This migration has been generated by hendrasadewa at 8/22/2020, 3:56:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Role" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL
)

CREATE TABLE "Staff" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "email" TEXT NOT NULL,
    "phone" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "salt" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "roleId" INTEGER NOT NULL,

FOREIGN KEY ("roleId") REFERENCES "Role"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Donator" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "email" TEXT NOT NULL,
    "phone" TEXT NOT NULL,
    "fullName" TEXT NOT NULL,
    "city" INTEGER NOT NULL,
    "ip" TEXT,
    "updatedAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "staffId" INTEGER,

FOREIGN KEY ("staffId") REFERENCES "Staff"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "DonationType" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "image" TEXT NOT NULL,
    "updatedAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "staffId" INTEGER NOT NULL,

FOREIGN KEY ("staffId") REFERENCES "Staff"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Donation" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "amount" REAL NOT NULL,
    "code" INTEGER NOT NULL,
    "amountAfterCode" REAL NOT NULL,
    "expiredAt" DATETIME NOT NULL,
    "verifiedAt" DATETIME NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "donationTypeId" INTEGER NOT NULL,
    "donatorId" INTEGER NOT NULL,
    "staffId" INTEGER NOT NULL,

FOREIGN KEY ("donationTypeId") REFERENCES "DonationType"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("donatorId") REFERENCES "Donator"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("staffId") REFERENCES "Staff"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "ZakatCalculation" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "nishab" REAL NOT NULL,
    "percentage" REAL NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "staffId" INTEGER NOT NULL,

FOREIGN KEY ("staffId") REFERENCES "Staff"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "Role.name_unique" ON "Role"("name")

CREATE UNIQUE INDEX "Staff.email_unique" ON "Staff"("email")

CREATE UNIQUE INDEX "Staff.phone_unique" ON "Staff"("phone")

CREATE UNIQUE INDEX "Donator.email_unique" ON "Donator"("email")

CREATE UNIQUE INDEX "Donator.phone_unique" ON "Donator"("phone")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200822085623-lemsos
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,96 @@
+datasource db {
+  provider = "sqlite"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Role {
+  id    Int     @id @default(autoincrement())
+  name  String  @unique
+  Staff Staff[]
+}
+
+model Staff {
+  id       Int    @id @default(autoincrement())
+  email    String @unique
+  phone    String @unique
+  role     Role   @relation(fields: [roleId], references: [id])
+  password String
+  salt     String
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now())
+
+  DonationType     DonationType[]
+  Donator          Donator[]
+  Donation         Donation[]
+  ZakatCalculation ZakatCalculation[]
+  roleId           Int
+}
+
+model Donator {
+  id       Int    @id @default(autoincrement())
+  email    String @unique
+  phone    String @unique
+  fullName String
+  city     Int
+
+  ip String?
+
+  updatedAt DateTime @default(now())
+  createdAt DateTime @default(now())
+
+  Staff    Staff?     @relation(fields: [staffId], references: [id])
+  staffId  Int?
+  Donation Donation[]
+}
+
+model DonationType {
+  id      Int    @id @default(autoincrement())
+  name    String
+  content String
+  image   String
+
+  updatedAt  DateTime @default(now())
+  createdAt  DateTime @default(now())
+  modifiedBy Staff    @relation(fields: [staffId], references: [id])
+
+  staffId  Int
+  Donation Donation[]
+}
+
+model Donation {
+  id              Int          @id @default(autoincrement())
+  type            DonationType @relation(fields: [donationTypeId], references: [id])
+  donator         Donator      @relation(fields: [donatorId], references: [id])
+  amount          Float
+  code            Int
+  amountAfterCode Float
+  expiredAt       DateTime
+
+  verifiedAt DateTime
+  verifiedBy Staff    @relation(fields: [staffId], references: [id])
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now())
+
+  donationTypeId Int
+  donatorId      Int
+  staffId        Int
+}
+
+model ZakatCalculation {
+  id         Int    @id @default(autoincrement())
+  name       String
+  nishab     Float
+  percentage Float
+
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @default(now())
+  modifiedBy Staff    @relation(fields: [staffId], references: [id])
+
+  staffId Int
+}
```


